generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
  MODERATOR
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING
}

model User {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // EVM wallet address (primary for Hypercore/Hyperliquid)
  evmAddress    String?    @unique
  
  nonce         String?
  lastLoginAt   DateTime?

  // Profile
  name   String?
  avatar String?
  role   UserRole   @default(USER)
  status UserStatus @default(ACTIVE)
  
  // Relations
  hypercoreWallet HypercoreWallet? @relation("HypercoreWallet")
}

// Hypercore Agent Wallet - EVM-based agent for Hyperliquid trading
model HypercoreWallet {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, name: "HypercoreWallet")

  // Agent wallet details
  agentAddress        String @unique  // Agent's public address (identifier on Hyperliquid)
  encryptedAgentKey   String          // Encrypted private key for signing orders
  masterAddress       String?         // Optional: user's master wallet (for reference)
  
  encryptionVersion   String   @default("v1")

  @@index([userId])
  @@index([agentAddress])
}
